<html>
	<head>
		<style>
			:root {
				background: black;
			}
			body {
				margin: 0;
				width: 100%;
				display: inline-grid;
			}

			.prompt-container {
				margin: 0 8px 8px 8px;
				background-color: aliceblue;
				opacity: 75%;
			}
			.prompt-container:first-child {
				margin-top: 8px;
			}
			.prompt-item {
				margin-top: 18px;
				margin-left: 18px;
				margin-right: 18px;
			}
			.prompt-item>p {
				margin-top: 0;
			}

			.hidden {
				display: none;
			}
		</style>
		<script type="text/javascript">
			function onload(){
				function refreshHistory(){
					fetch("http://127.0.0.1:8188/history").then(response=>response.json()).then(result => {
						historyKeys = Object.keys(result);
						for (const keyResult of Object.keys(result)) {
							const history = result[keyResult];
							for (const keyOutputs of Object.keys(history.outputs)) {
								const output = history.outputs[keyOutputs];
								let index = 0;
								for (const keyImages of Object.keys(output.images)) {
									const imageResult = output.images[keyImages];
									const animated = output.animated ? output.animated[index++] : false;
									const imageURL = 'http://127.0.0.1:8188/view?filename='+imageResult['filename']+'&animated='+animated;
									let promptContainer = document.getElementById(imageURL);
									if(!promptContainer){
										promptContainer = document.createElement('div');
										promptContainer.id = imageURL;
										promptContainer.classList.add('prompt-container');
										for (const prompt of history.prompt) {
											if(typeof prompt === 'object'){
												for (const keyPrompt of Object.keys(prompt)) {
													const p = prompt[keyPrompt];
													if(p.class_type === 'CLIPTextEncode'){
														const promptItem = document.createElement('div');
														promptItem.classList.add('prompt-item');
														promptContainer.appendChild(promptItem);
														let paragraph = document.createElement('label');
														paragraph.innerText = 'Prompt '+keyPrompt;
														promptItem.appendChild(paragraph);
														paragraph = document.createElement('p');
														let code = document.createElement('code');
														code.innerText = p.inputs.text
														paragraph.appendChild(code);
														promptItem.appendChild(paragraph);
													}
												}
											}
										}
										document.body.prepend(promptContainer);
									}
								}
							}
						}
					}).finally(()=>{
						requestAnimationFrame(refreshHistory);
					});
				}
				requestAnimationFrame(refreshHistory);
			}
		</script>
	</head>
	<body onload="onload()"></body>
</html>
